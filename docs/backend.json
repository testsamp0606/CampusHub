
{
  "entities": {
    "School": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "School",
      "type": "object",
      "description": "Represents a school or college.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the school entity." },
        "name": { "type": "string", "description": "The name of the school." },
        "address": { "type": "string", "description": "The address of the school." },
        "phone": { "type": "string", "description": "The phone number of the school." },
        "email": { "type": "string", "description": "The email address of the school.", "format": "email" }
      },
      "required": ["id", "name"]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the system (admin, teacher, accountant).",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the user entity." },
        "schoolId": { "type": "string", "description": "Reference to School. (Relationship: School 1:N User)" },
        "username": { "type": "string", "description": "The username of the user." },
        "role": { "type": "string", "description": "The role of the user (e.g., admin, teacher, accountant)." },
        "email": { "type": "string", "description": "The email address of the user.", "format": "email" }
      },
      "required": ["id", "schoolId", "username", "role", "email"]
    },
    "Student": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Student",
      "type": "object",
      "description": "Represents a student in the school.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the student entity (Admission Number)." },
        "schoolId": { "type": "string", "description": "Reference to School." },
        "name": { "type": "string", "description": "The full name of the student." },
        "gender": { "type": "string", "description": "The gender of the student." },
        "dateOfBirth": { "type": "string", "description": "The date of birth of the student.", "format": "date" },
        "bloodGroup": { "type": "string", "description": "Student's blood group." },
        "category": { "type": "string", "description": "Student's category (e.g., General, SC/ST, OBC)." },
        "aadhaar": { "type": "string", "description": "Student's Aadhaar number." },
        "studentPhoto": { "type": "string", "description": "URL to the student's photo." },
        "academicYear": { "type": "string", "description": "The current academic year for the student." },
        "classId": { "type": "string", "description": "Reference to Class." },
        "section": { "type": "string", "description": "The section of the class (e.g., A, B, C)." },
        "rollNumber": { "type": "string", "description": "Student's roll number in the class." },
        "mediumOfInstruction": { "type": "string", "description": "e.g., English, Hindi." },
        "previousSchool": { "type": "string", "description": "Name of the previous school attended." },
        "previousBoard": { "type": "string", "description": "Board of the previous school (e.g., CBSE, ICSE)." },
        "fatherName": { "type": "string" },
        "motherName": { "type": "string" },
        "fatherMobile": { "type": "string" },
        "motherMobile": { "type": "string" },
        "parentEmail": { "type": "string", "format": "email" },
        "fatherOccupation": { "type": "string" },
        "motherOccupation": { "type": "string" },
        "fatherAnnualIncome": { "type": "number" },
        "motherAnnualIncome": { "type": "number" },
        "currentAddress": { "type": "string" },
        "permanentAddress": { "type": "string" },
        "emergencyContact": { "type": "string" }
      },
      "required": ["id", "schoolId", "name", "gender", "dateOfBirth", "classId", "fatherName", "motherName", "fatherMobile", "motherMobile", "currentAddress", "permanentAddress", "emergencyContact"]
    },
    "Teacher": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Teacher",
      "type": "object",
      "description": "Represents a teacher in the school.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the teacher entity." },
        "schoolId": { "type": "string", "description": "Reference to School." },
        "name": { "type": "string", "description": "The name of the teacher." },
        "subject": { "type": "string", "description": "The subject taught by the teacher." },
        "email": { "type": "string", "description": "The email of the teacher", "format": "email" }
      },
      "required": ["id", "schoolId", "name", "subject", "email"]
    },
    "Class": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Class",
      "type": "object",
      "description": "Represents a class in the school.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the class entity." },
        "schoolId": { "type": "string", "description": "Reference to School." },
        "name": { "type": "string", "description": "The name of the class (e.g., Grade 10, Section A)." },
        "teacherId": { "type": "string", "description": "Reference to Teacher." }
      },
      "required": ["id", "schoolId", "name", "teacherId"]
    },
    "Attendance": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Attendance",
      "type": "object",
      "description": "Represents the attendance record for a student or teacher on a specific date.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the attendance record." },
        "schoolId": { "type": "string", "description": "Reference to School." },
        "userId": { "type": "string", "description": "Reference to User (Student or Teacher)." },
        "date": { "type": "string", "description": "The date of the attendance record.", "format": "date-time" },
        "status": { "type": "string", "description": "e.g., present, absent, excused." },
        "attendanceType": { "type": "string", "description": "Type of attendance ('student' or 'teacher')." }
      },
      "required": ["id", "schoolId", "userId", "date", "status", "attendanceType"]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense record for the school.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the expense record." },
        "schoolId": { "type": "string", "description": "Reference to School." },
        "date": { "type": "string", "description": "The date of the expense.", "format": "date-time" },
        "description": { "type": "string", "description": "Description of the expense." },
        "amount": { "type": "number", "description": "The amount of the expense." }
      },
      "required": ["id", "schoolId", "date", "description", "amount"]
    },
    "Account": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Account",
      "type": "object",
      "description": "Represents an account record for the school.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the account record." },
        "schoolId": { "type": "string", "description": "Reference to School." },
        "accountName": { "type": "string", "description": "Name of the account" },
        "balance": { "type": "number", "description": "Balance of the account" },
        "lastTransactionDate": { "type": "string", "description": "The date of the last transaction.", "format": "date-time" }
      },
      "required": ["id", "schoolId", "accountName", "balance", "lastTransactionDate"]
    },
    "Asset": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Asset",
      "type": "object",
      "description": "Represents an asset owned by the school.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the asset." },
        "schoolId": { "type": "string", "description": "Reference to School." },
        "name": { "type": "string", "description": "Name of the asset" },
        "description": { "type": "string", "description": "Description of the asset" },
        "purchaseDate": { "type": "string", "description": "Date the asset was purchased", "format": "date-time" },
        "value": { "type": "number", "description": "Current value of the asset." }
      },
      "required": ["id", "schoolId", "name", "description", "purchaseDate", "value"]
    },
    "Conversation": {
      "title": "Conversation",
      "description": "A conversation thread between multiple users.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "subject": { "type": "string" },
        "participantIds": { "type": "array", "items": { "type": "string" } },
        "lastMessage": { "type": "string" },
        "lastMessageTimestamp": { "type": "string", "format": "date-time" },
        "readBy": { "type": "array", "items": { "type": "string" } },
        "schoolId": { "type": "string" }
      },
      "required": ["id", "subject", "participantIds", "lastMessageTimestamp", "schoolId"]
    },
    "Message": {
      "title": "Message",
      "description": "A single message within a conversation.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "conversationId": { "type": "string" },
        "senderId": { "type": "string" },
        "content": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" },
        "schoolId": { "type": "string" }
      },
      "required": ["id", "conversationId", "senderId", "content", "timestamp", "schoolId"]
    },
    "Book": {
      "title": "Book",
      "description": "Represents a book or resource in the library.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "title": { "type": "string" },
        "author": { "type": "string" },
        "isbn": { "type": "string" },
        "publisher": { "type": "string" },
        "edition": { "type": "string" },
        "category": { "type": "string" },
        "language": { "type": "string" },
        "quantity": { "type": "number" },
        "issued": { "type": "number" },
        "lost": { "type": "number" },
        "resourceType": { "type": "string" },
        "barcode": { "type": "string" },
        "shelf": { "type": "string" },
        "rack": { "type": "string" },
        "coverImage": { "type": "string", "format": "uri" },
        "schoolId": { "type": "string" }
      },
      "required": ["id", "title", "author", "isbn", "quantity", "schoolId"]
    },
    "BookIssue": {
      "title": "Book Issue",
      "description": "Represents a record of a book being issued to a student.",
      "type": "object",
      "properties": {
        "issueId": { "type": "string" },
        "bookId": { "type": "string" },
        "studentId": { "type": "string" },
        "issueDate": { "type": "string", "format": "date-time" },
        "dueDate": { "type": "string", "format": "date" },
        "returnDate": { "type": "string", "format": "date-time" },
        "status": { "type": "string", "enum": ["Issued", "Returned"] },
        "fineAmount": { "type": "number" },
        "fineStatus": { "type": "string", "enum": ["Paid", "Unpaid"] },
        "schoolId": { "type": "string" }
      },
      "required": ["issueId", "bookId", "studentId", "issueDate", "dueDate", "status", "schoolId"]
    },
    "Vehicle": {
      "title": "Vehicle",
      "description": "Represents a school transport vehicle.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "vehicleNumber": { "type": "string" },
        "type": { "type": "string", "enum": ["Bus", "Van", "Mini-bus"] },
        "capacity": { "type": "number" },
        "driverName": { "type": "string" },
        "driverContact": { "type": "string" },
        "status": { "type": "string", "enum": ["Active", "Maintenance"] },
        "schoolId": { "type": "string" }
      },
      "required": ["id", "vehicleNumber", "type", "capacity", "driverName", "driverContact", "status", "schoolId"]
    },
    "Route": {
      "title": "Route",
      "description": "Represents a transport route.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "routeName": { "type": "string" },
        "vehicleId": { "type": "string" },
        "stops": { "type": "array", "items": { "type": "string" } },
        "schoolId": { "type": "string" }
      },
      "required": ["id", "routeName", "vehicleId", "stops", "schoolId"]
    },
    "StudentTransport": {
      "title": "Student Transport",
      "description": "Represents the transport allocation for a student.",
      "type": "object",
      "properties": {
        "allocationId": { "type": "string" },
        "studentId": { "type": "string" },
        "routeId": { "type": "string" },
        "stop": { "type": "string" },
        "feeStatus": { "type": "string", "enum": ["Paid", "Unpaid"] },
        "schoolId": { "type": "string" }
      },
      "required": ["allocationId", "studentId", "routeId", "stop", "feeStatus", "schoolId"]
    },
    "Fee": {
      "title": "Fee",
      "description": "Represents a fee invoice for a student.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "studentId": { "type": "string" },
        "amount": { "type": "number" },
        "dueDate": { "type": "string", "format": "date" },
        "status": { "type": "string", "enum": ["Paid", "Unpaid", "Overdue"] },
        "description": { "type": "string" },
        "schoolId": { "type": "string" }
      },
      "required": ["id", "studentId", "amount", "dueDate", "status", "schoolId"]
    },
    "Timetable": {
      "title": "Timetable",
      "description": "Represents the timetable for a specific class on a specific day.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "classId": { "type": "string" },
        "day": { "type": "string", "enum": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"] },
        "entries": { "type": "array", "items": { "$ref": "#/backend/entities/TimetableEntry" } },
        "schoolId": { "type": "string" }
      },
      "required": ["id", "classId", "day", "schoolId"]
    },
    "TimetableEntry": {
      "title": "Timetable Entry",
      "description": "Represents a single period in a timetable.",
      "type": "object",
      "properties": {
        "period": { "type": "number" },
        "subjectId": { "type": "string" },
        "teacherId": { "type": "string" },
        "time": { "type": "string" }
      },
      "required": ["period", "subjectId", "teacherId", "time"]
    },
    "RolePermission": {
      "title": "Role Permission",
      "description": "Defines permissions for a specific role and module.",
      "type": "object",
      "properties": {
        "role": { "type": "string" },
        "module": { "type": "string" },
        "permissions": { "type": "array", "items": { "type": "string", "enum": ["V", "C", "E", "A"] } },
        "schoolId": { "type": "string" }
      },
      "required": ["role", "module", "permissions", "schoolId"]
    },
    "Examination": {
        "title": "Examination",
        "description": "Represents a formal school examination event.",
        "type": "object",
        "properties": {
            "id": { "type": "string" },
            "name": { "type": "string" },
            "type": { "type": "string", "enum": ["Mid-Term", "Half-Yearly", "Annual"] },
            "startDate": { "type": "string", "format": "date" },
            "endDate": { "type": "string", "format": "date" },
            "status": { "type": "string", "enum": ["Draft", "Scheduled", "Published", "Completed"] },
            "schoolId": { "type": "string" }
        },
        "required": ["id", "name", "type", "startDate", "endDate", "status", "schoolId"]
    },
    "Assessment": {
        "title": "Assessment",
        "description": "Represents a continuous assessment for a class.",
        "type": "object",
        "properties": {
            "id": { "type": "string" },
            "name": { "type": "string" },
            "classId": { "type": "string" },
            "date": { "type": "string", "format": "date" },
            "type": { "type": "string", "enum": ["Unit Test", "Assignment", "Project", "Practical", "Oral"] },
            "maxMarks": { "type": "number" },
            "status": { "type": "string", "enum": ["Scheduled", "Completed", "Published"] },
            "schoolId": { "type": "string" }
        },
        "required": ["id", "name", "classId", "date", "type", "maxMarks", "status", "schoolId"]
    },
    "Mark": {
        "title": "Mark",
        "description": "Represents a student's mark in an assessment or exam.",
        "type": "object",
        "properties": {
            "id": { "type": "string" },
            "assessmentId": { "type": "string" },
            "studentId": { "type": "string" },
            "marks": { "type": "number" },
            "schoolId": { "type": "string" }
        },
        "required": ["id", "assessmentId", "studentId", "marks", "schoolId"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/schools/{schoolId}",
        "definition": {
          "entityName": "School",
          "schema": { "$ref": "#/backend/entities/School" },
          "description": "Stores school information.",
          "params": [{ "name": "schoolId", "description": "The unique ID of the school." }]
        }
      },
      {
        "path": "/schools/{schoolId}/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": { "$ref": "#/backend/entities/User" },
          "description": "Stores user information.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "userId", "description": "The unique ID of the user." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/students/{studentId}",
        "definition": {
          "entityName": "Student",
          "schema": { "$ref": "#/backend/entities/Student" },
          "description": "Stores student information.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "studentId", "description": "The unique ID of the student." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/teachers/{teacherId}",
        "definition": {
          "entityName": "Teacher",
          "schema": { "$ref": "#/backend/entities/Teacher" },
          "description": "Stores teacher information.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "teacherId", "description": "The unique ID of the teacher." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/classes/{classId}",
        "definition": {
          "entityName": "Class",
          "schema": { "$ref": "#/backend/entities/Class" },
          "description": "Stores class information.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "classId", "description": "The unique ID of the class." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/attendances/{attendanceId}",
        "definition": {
          "entityName": "Attendance",
          "schema": { "$ref": "#/backend/entities/Attendance" },
          "description": "Stores attendance information.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "attendanceId", "description": "The unique ID of the attendance." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": { "$ref": "#/backend/entities/Expense" },
          "description": "Stores expense information.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "expenseId", "description": "The unique ID of the expense." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/accounts/{accountId}",
        "definition": {
          "entityName": "Account",
          "schema": { "$ref": "#/backend/entities/Account" },
          "description": "Stores account information.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "accountId", "description": "The unique ID of the account." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/assets/{assetId}",
        "definition": {
          "entityName": "Asset",
          "schema": { "$ref": "#/backend/entities/Asset" },
          "description": "Stores asset information.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "assetId", "description": "The unique ID of the asset." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/conversations/{conversationId}",
        "definition": {
          "entityName": "Conversation",
          "schema": { "$ref": "#/backend/entities/Conversation" },
          "description": "Stores conversation threads.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "conversationId", "description": "The unique ID of the conversation." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/conversations/{conversationId}/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": { "$ref": "#/backend/entities/Message" },
          "description": "Stores messages within a conversation.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "conversationId", "description": "The unique ID of the conversation." },
            { "name": "messageId", "description": "The unique ID of the message." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/books/{bookId}",
        "definition": {
          "entityName": "Book",
          "schema": { "$ref": "#/backend/entities/Book" },
          "description": "Stores library book information.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "bookId", "description": "The unique ID of the book." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/bookIssues/{issueId}",
        "definition": {
          "entityName": "BookIssue",
          "schema": { "$ref": "#/backend/entities/BookIssue" },
          "description": "Stores book issue records.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "issueId", "description": "The unique ID of the issue record." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/vehicles/{vehicleId}",
        "definition": {
          "entityName": "Vehicle",
          "schema": { "$ref": "#/backend/entities/Vehicle" },
          "description": "Stores transport vehicle information.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "vehicleId", "description": "The unique ID of the vehicle." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/routes/{routeId}",
        "definition": {
          "entityName": "Route",
          "schema": { "$ref": "#/backend/entities/Route" },
          "description": "Stores transport route information.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "routeId", "description": "The unique ID of the route." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/studentTransports/{allocationId}",
        "definition": {
          "entityName": "StudentTransport",
          "schema": { "$ref": "#/backend/entities/StudentTransport" },
          "description": "Stores transport allocation records.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "allocationId", "description": "The unique ID of the allocation record." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/fees/{feeId}",
        "definition": {
          "entityName": "Fee",
          "schema": { "$ref": "#/backend/entities/Fee" },
          "description": "Stores fee invoices.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "feeId", "description": "The unique ID of the fee invoice." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/timetables/{timetableId}",
        "definition": {
          "entityName": "Timetable",
          "schema": { "$ref": "#/backend/entities/Timetable" },
          "description": "Stores class timetables.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "timetableId", "description": "The unique ID of the timetable record." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/permissions/{roleName}",
        "definition": {
          "entityName": "RolePermission",
          "schema": { "$ref": "#/backend/entities/RolePermission" },
          "description": "Stores role-based permissions for different modules.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "roleName", "description": "The name of the role (e.g., Admin, Teacher)." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/examinations/{examId}",
        "definition": {
          "entityName": "Examination",
          "schema": { "$ref": "#/backend/entities/Examination" },
          "description": "Stores formal examination information.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "examId", "description": "The unique ID of the examination." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/assessments/{assessmentId}",
        "definition": {
          "entityName": "Assessment",
          "schema": { "$ref": "#/backend/entities/Assessment" },
          "description": "Stores continuous assessment information.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "assessmentId", "description": "The unique ID of the assessment." }
          ]
        }
      },
      {
        "path": "/schools/{schoolId}/marks/{markId}",
        "definition": {
          "entityName": "Mark",
          "schema": { "$ref": "#/backend/entities/Mark" },
          "description": "Stores student marks for an assessment or exam.",
          "params": [
            { "name": "schoolId", "description": "The unique ID of the school." },
            { "name": "markId", "description": "The unique ID for the mark record." }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to follow best practices for security, scalability, and debuggability, focusing on Authorization Independence and Structural Segregation. Authorization Independence is achieved through denormalization: schoolId is included in all subcollections to avoid costly and insecure `get()` calls in security rules. Structural Segregation ensures that each collection has a homogeneous security posture. Path-based ownership is used where appropriate (e.g., `/schools/{schoolId}/users/{userId}`). The design facilitates secure `list` operations by segregating data based on access requirements. It supports integrity by providing explicit state modeling and predictable schemas."
  }
}
