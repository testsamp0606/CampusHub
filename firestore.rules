rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Grant open access for any authenticated user during development.
    // This allows reads and writes to all collections.

    match /schools/{schoolId} {
      allow read, write: if request.auth != null;

      match /users/{userId} {
        allow read, write: if request.auth != null;
      }
      match /students/{studentId} {
        allow read, write: if request.auth != null;
      }
      match /teachers/{teacherId} {
        allow read, write: if request.auth != null;
      }
      match /classes/{classId} {
        allow read, write: if request.auth != null;
      }
      match /subjects/{subjectId} {
        allow read, write: if request.auth != null;
      }
      match /attendances/{attendanceId} {
        allow read, write: if request.auth != null;
      }
      match /events/{eventId} {
        allow read, write: if request.auth != null;
      }
      match /timetables/{timetableId} {
        allow read, write: if request.auth != null;
      }
      match /exams/{examId} {
        allow read, write: if request.auth != null;
      }
       match /marks/{markId} {
        allow read, write: if request.auth != null;
      }
      match /fees/{feeId} {
        allow read, write: if request.auth != null;
      }
      match /expenses/{expenseId} {
        allow read, write: if request.auth != null;
      }
      match /assets/{assetId} {
        allow read, write: if request.auth != null;
      }
      match /library/{bookId} {
        allow read, write: if request.auth != null;
      }
       match /bookIssues/{issueId} {
        allow read, write: if request.auth != null;
      }
      match /books/{bookId} {
        allow read, write: if request.auth != null;
      }
      match /transport/{routeId} {
        allow read, write: if request.auth != null;
      }
      match /vehicles/{vehicleId} {
        allow read, write: if request.auth != null;
      }
       match /routes/{routeId} {
        allow read, write: if request.auth != null;
      }
      match /studentTransports/{transportId} {
        allow read, write: if request.auth != null;
      }
      match /announcements/{announcementId} {
        allow read, write: if request.auth != null;
      }
      match /conversations/{conversationId} {
        allow read, write: if request.auth != null;

        // Explicitly allow access to the messages sub-collection
        match /messages/{messageId} {
          allow read, write: if request.auth != null;
        }
      }
      match /permissions/{roleId} {
        allow read, write: if request.auth != null;
      }
    }
  }
}